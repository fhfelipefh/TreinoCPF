<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Treino CPF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div class="container">

        <h1 class="display-4 text-center">CPF</h1>

        <!-- campo de texto para receber o cpf -->
        <div class="card">
            <div class="card-body">
                <input id="cpfInput" class="form-control form-control-lg text-center" type="text" maxlength="14" placeholder="Inserir CPF" aria-label=".form-control-lg example">
            </div>
        </div>

        <!-- teclado virtual numérico -->
        <div class="card">
            <div class="card-body text-center">
                
                <table class="table table-bordered table-lg" id="virtual-keyboard">
                    <tr>
                        <td><button id="um" class="btn btn-secondary" value="1">1</button></td>
                        <td><button id="dois" class="btn btn-secondary" value="2">2</button></td>
                        <td><button id="tres" class="btn btn-secondary" value="3">3</button></td>
                    </tr>
            
                    <tr>
                        <td><button id="quatro" class="btn btn-secondary" value="4">4</button></td>
                        <td><button id="cinco" class="btn btn-secondary" value="5">5</button></td>
                        <td><button id="seis" class="btn btn-secondary" value="6">6</button></td>
                    </tr>
            
                    <tr>
                        <td><button id="sete" class="btn btn-secondary" value="7">7</button></td>
                        <td><button id="oito" class="btn btn-secondary" value="8">8</button></td>
                        <td><button id="nove" class="btn btn-secondary" value="9">9</button></td>
                    </tr>
            
                    <tr>
                        <td></td>
                        <td><button id="zero" class="btn btn-secondary" value="0">0</button></td>
                    </tr>
                </table>
                    
                <table class="table table-bordered table-sm">
                    <tr>
                        <td><button id="apagar" class="btn btn-warning" value="apagar">Apagar</button></td>
                        <td><button id="limpar" class="btn btn-danger" value="limpar">Limpar</button></td>
                    </tr>
                </table>

                <div class="card-body">
                    <p class="fw-bold" id="message"></p>
                </div>

        </div>

        <!-- botão para validar o cpf e iniciar a prova -->
        <div class="card">
            <div class="card-body text-center">
                <button id="prova" class="btn btn-primary btn-lg" type="submit">Ir para a prova</button>
            </div>
        </div>

    </div>
    <script>
        window.onload = function() {
            document.getElementById("cpfInput").focus();
        }
        // apaga o último caractere digitado no campo de texto
        document.getElementById("apagar").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf.substring(0, cpf.length - 1);
        }
        // limpa o campo de texto
        document.getElementById("limpar").onclick = function() {
            document.getElementById("cpfInput").value = "";
        }
        // formata a entrada do cpf para o formato ###.###.###-## quando chamar essa função
        function formatarCpf(cpf) {
            var cpfFormatado = cpf.replace(/\D/g, "");
            cpfFormatado = cpfFormatado.replace(/(\d{3})(\d)/, "$1.$2");
            cpfFormatado = cpfFormatado.replace(/(\d{3})(\d)/, "$1.$2");
            cpfFormatado = cpfFormatado.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
            return cpfFormatado;
        }
        // adiciona o caractere digitado no campo de texto e formata o cpf
        document.getElementById("um").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "1";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("dois").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "2";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("tres").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "3";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("quatro").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "4";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("cinco").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "5";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("seis").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "6";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("sete").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "7";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("oito").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "8";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("nove").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "9";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        document.getElementById("zero").onclick = function() {
            var cpf = document.getElementById("cpfInput").value;
            document.getElementById("cpfInput").value = cpf + "0";
            document.getElementById("cpfInput").value = formatarCpf(document.getElementById("cpfInput").value);
        }
        // valida o cpf digitado e envia para a página de prova 
        document.getElementById("prova").onclick = function() {
            var status = false;
            var cpf = document.getElementById("cpfInput").value;
            if (cpf.length == 14) {
                var cpfFormatado = cpf.replace(/\D/g, "");
                var soma = 0;
                var resto;
                for (var i = 1; i <= 9; i++) {
                    soma = soma + parseInt(cpfFormatado.substring(i - 1, i)) * (11 - i);
                }
                resto = (soma * 10) % 11;
                if ((resto == 10) || (resto == 11)) {
                    resto = 0;
                }
                if (resto != parseInt(cpfFormatado.substring(9, 10))) {
                    // exibe mensagem de erro na div message
                    document.getElementById("message").innerHTML = "CPF inválido, clique em limpar e tente novamente!";
                    status = false;
                }
                soma = 0;
                for (var i = 1; i <= 10; i++) {
                    soma = soma + parseInt(cpfFormatado.substring(i - 1, i)) * (12 - i);
                }
                resto = (soma * 10) % 11;
                if ((resto == 10) || (resto == 11)) {
                    resto = 0;
                }
                if (resto != parseInt(cpfFormatado.substring(10, 11))) {
                    document.getElementById("message").innerHTML = "CPF inválido, clique em limpar e tente novamente!";
                    status = false;
                }
                   document.getElementById("message").innerHTML = "CPF válido, parabéns!";
                   status = true;
            } else {
                   document.getElementById("message").innerHTML = "CPF inválido, clique em limpar e tente novamente!";
                   status = false;
            }
            // se status for false altera a cor do texto message para vermelho
            if (status == false) {
                document.getElementById("message").style.color = "red";
            } else {
                document.getElementById("message").style.color = "green";
            }
        }
        // limpa o campo de texto e o texto message
        document.getElementById("limpar").onclick = function() {
            document.getElementById("cpfInput").value = "";
            document.getElementById("message").innerHTML = "";
        }

       </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"  crossorigin="anonymous"></script>
</body>
</html>